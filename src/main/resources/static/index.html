<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Catering Project</title>
<link href="css/bootstrap.min.css" rel="stylesheet">
<script src="js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
	function changeToHome() {
		document.getElementById("Container").innerHTML = '';
		var button1 =document.getElementById("button1");
		button1.onclick="";
		button1.textContent="";
		button1.hidden=true;
		var button2 =document.getElementById("button2");
		button2.onclick="";
		button2.textContent="";
		button2.hidden=true;
		var dropdownSort =document.getElementById("dropdownSort");
		button2.innerHTML="";
		button2.hidden=true;
		dropdownSortDesc.hidden=true;
		dropdownSort.hidden=true;
	};
	
	function changeToIngredient() {
		var button1 =document.getElementById("button1");
		button1.onclick=getAllIngredients;
		button1.textContent="Get All Ingredients";
		button1.hidden=false;
		var button2 =document.getElementById("button2");
		button2.onclick=postIngredient;
		button2.textContent="Add Dummy Ingredient";
		button2.hidden=false;
	};
	
	function getAllIngredients() {
		var dropdownSort =document.getElementById("dropdownSort");
		dropdownSort.onchange = getAllIngredientsSorted;
		dropdownSort.hidden=false;
		dropdownSort.innerHTML = '';
		var dropdownSortDesc =document.getElementById("dropdownSortDesc");
		dropdownSortDesc.onchange = getAllIngredientsSorted;
		dropdownSortDesc.hidden=false;
		dropdownSortDesc.value="Ascending";
		getDataList("ingredient");
		
	};
	
	function getAllIngredientsSorted() {
		var key = document.getElementById("dropdownSort").value;
		var desc = document.getElementById("dropdownSortDesc").value;
		if(desc=="Descending")
			getDataListSorted("ingredient",key,true,false);
		else
			getDataListSorted("ingredient",key,false,false);
		document.getElementById("dropdownSort").value = key;
		
	};
	
	function postIngredient() {
		postData("ingredient",'{"name":"Onion","type":"Vegetable","unitType":"Piece","caloriePerUnit":0.10}');
		postData("ingredient",'{"name":"Potato","type":"Vegetable","unitType":"Piece","caloriePerUnit":0.40}');
		postData("ingredient",'{"name":"Beef Meat Ball","type":"Vegetable","unitType":"gr","caloriePerUnit":0.15}');
		postData("ingredient",'{"name":"Black Pepper","type":"Spice","unitType":"Piece","caloriePerUnit":0.01}');
		postData("ingredient",'{"name":"Black Pepper Grinded","type":"Spice","unitType":"gr","caloriePerUnit":0.01}');
		
	};

	function postData(api,data) {
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 202) {
				document.getElementById("Container").innerHTML = this.responseText+". Dummy Item Added";
			}
		};
		xhttp.open("POST", "http://localhost:8082/api/" + api, true);
		xhttp.setRequestHeader("Content-type", "application/json");
		xhttp.send(data);
	}
	
	function getDataList(api) {
		getDataListSorted(api,"id",false,true);
	}
	
	function getDataListSorted(api,key,sort, firstTime) {
		var myObj, myArr, x, txt = "";
		var xhttp = new XMLHttpRequest();
		var container = document.getElementById("Container");
		container.innerHTML = '';
		
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				myArr = JSON.parse(this.responseText);
				myArr = sortArray(myArr,key, sort);
				var table = document.createElement("Table");
				for (x in myArr) {
					var myObj = myArr[x];
					var row = document.createElement("TR");
					for(y in myObj) {
						var col = document.createElement("TD");
						var textNode = document.createTextNode(myObj[y]);
						col.appendChild(textNode);
						row.appendChild(col);
						if(firstTime && x==0){
							var option = document.createElement("OPTION");
							var optionText = document.createTextNode(y);
							option.appendChild(optionText);
							option.value=y;
							dropdownSort.appendChild(option);
						};
					};
					table.appendChild(row);
				};
				table.className='table table-striped table-bordered table-hover';
				container.appendChild(table);
			};
		};
		xhttp.open("GET", "http://localhost:8082/api/" + api);
		xhttp.setRequestHeader("Content-type", "application/json");
		xhttp.send();
	}
	function sortArray(array,key, sort) {
	    array.sort(function(a, b) {
	        if (a[key] < b[key])
	            return sort ? 1 : -1;
	        if (a[key] > b[key])
	            return sort ? -1 : 1;
	        return 0;
	    });
	    return array;
	};
</script>
</head>
<body>
	<nav class="navbar navbar-default">
	  <div class="container-fluid">
	    <div class="navbar-header">
	      <a class="navbar-brand" href="#">ITPH - Fase2 - Catering Project</a>
	    </div>
	    <ul class="nav navbar-nav">
	      <li class="active"><a href="#" onclick="changeToHome()">Home</a></li>
	      <li><a href="#">Page 1</a></li>
	      <li><a href="#">Page 2</a></li>
	      <li><a href="#" onclick="changeToIngredient()">Ingredient</a></li>
	    </ul>
	  </div>
	</nav>
	<div class="container-fluid">
		<div class="row">
			<button id="button1" hidden="true"></button>
	        <button id="button2" hidden="true"></button>
            <select id="dropdownSort" hidden="true" name="key"></select>
            <select id="dropdownSortDesc" hidden="true" name="Desc">
            	<option value="Ascending">Ascending</option>
            	<option value="Descending"> Descending</option>
            </select>
        </div>
		<div id="Container" class="row">
        </div>
    </div>
</body>
</html>